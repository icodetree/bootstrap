/*============================================================
* Description : Swipe Slide
*============================================================*/

// myNoteSlide
const myNoteSlide = new Swiper ('.myNoteSlide .swiperType_01', {
  slidesPerView: 1.8,
  spaceBetween: 0,
  centeredSlides: false,
  pagination: {
    el: '.myNoteSlide .swiperType_01 .swiper-pagination',
    clickable: true,
  },
  navigation: {
    nextEl: '.myNoteSlide .swiper-button-next',
    prevEl: '.myNoteSlide .swiper-button-prev',
  },

  breakpoints: {
    0: {
      slidesPerView: 1.1,
    },
    540: {
      slidesPerView: 2,
    },
  },
});

// myNoteAddSlide
const myNoteAddSlide = new Swiper ('.myNoteAddSlide .swiperType_01', {
  slidesPerView: 1.8,
  spaceBetween: 25,
  centeredSlides: false,
  pagination: {
    el: '.myNoteAddSlide .swiperType_01 .swiper-pagination',
    clickable: true,
  },
  navigation: {
    nextEl: '.myNoteAddSlide .swiper-button-next',
    prevEl: '.myNoteAddSlide .swiper-button-prev',
  },

  breakpoints: {
    0: {
      slidesPerView: 1.1,
    },
    540: {
      slidesPerView: 2,
    },
  },
});

// contentTitleSlide
const swiper_title = new Swiper ('.contentTitleSlide .swiperType_02', {
  loop: false,
  slidesPerView: 1.8,
  spaceBetween: 20,
  centeredSlides: false,

  breakpoints: {
    0: {
      slidesPerView: 1.5,
    },
    540: {
      spaceBetween: 20,
      slidesPerView: 2.8,
    },
    960: {
      spaceBetween: 25,
      slidesPerView: 5,
    },
  },
});

// cardSlide_01
const cardSlide_01 = new Swiper ('.cardSlide_01 .swiperType_card', {
  loop: false,
  slidesPerView: 1.8,
  spaceBetween: 20,
  centeredSlides: false,
  pagination: {
    el: '.cardSlide_01 .swiperType_card .swiper-pagination',
    clickable: true,
  },
  navigation: {
    nextEl: '.cardSlide_01 .swiper-button-next',
    prevEl: '.cardSlide_01 .swiper-button-prev',
  },

  breakpoints: {
    0: {
      slidesPerView: 1.2,
    },
    540: {
      slidesPerView: 2.5,
    },
    960: {
      slidesPerView: 4,
    },
  },
});

// cardSlide_02
const cardSlide_02 = new Swiper ('.cardSlide_02 .swiperType_card', {
  loop: false,
  slidesPerView: 1.8,
  spaceBetween: 20,
  centeredSlides: false,
  pagination: {
    el: '.cardSlide_02 .swiperType_card .swiper-pagination',
    clickable: true,
  },
  navigation: {
    nextEl: '.cardSlide_02 .swiper-button-next',
    prevEl: '.cardSlide_02 .swiper-button-prev',
  },

  breakpoints: {
    0: {
      slidesPerView: 1.2,
    },
    540: {
      slidesPerView: 2.5,
    },
    960: {
      slidesPerView: 4,
    },
  },
});

// cardSlide_03
const cardSlide_03 = new Swiper ('.cardSlide_03 .swiperType_card', {
  loop: false,
  slidesPerView: 1.8,
  spaceBetween: 20,
  centeredSlides: false,
  pagination: {
    el: '.cardSlide_03 .swiperType_card .swiper-pagination',
    clickable: true,
  },
  navigation: {
    nextEl: '.cardSlide_03 .swiper-button-next',
    prevEl: '.cardSlide_03 .swiper-button-prev',
  },

  breakpoints: {
    0: {
      slidesPerView: 1.2,
    },
    540: {
      slidesPerView: 2.5,
    },
    960: {
      slidesPerView: 4,
    },
  },
});

// cardSlide_04
const cardSlide_04 = new Swiper ('.cardSlide_04 .swiperType_card', {
  loop: false,
  slidesPerView: 1.8,
  spaceBetween: 20,
  centeredSlides: false,
  pagination: {
    el: '.cardSlide_04 .swiperType_card .swiper-pagination',
    clickable: true,
  },
  navigation: {
    nextEl: '.cardSlide_04 .swiper-button-next',
    prevEl: '.cardSlide_04 .swiper-button-prev',
  },

  breakpoints: {
    0: {
      slidesPerView: 1.2,
    },
    540: {
      slidesPerView: 2.5,
    },
    960: {
      slidesPerView: 4,
    },
  },
});

// cardSlide_05
const cardSlide_05 = new Swiper ('.cardSlide_05 .swiperType_card', {
  loop: false,
  slidesPerView: 1.8,
  spaceBetween: 20,
  centeredSlides: false,
  pagination: {
    el: '.cardSlide_05 .swiperType_card .swiper-pagination',
    clickable: true,
  },
  navigation: {
    nextEl: '.cardSlide_05 .swiper-button-next',
    prevEl: '.cardSlide_05 .swiper-button-prev',
  },

  breakpoints: {
    0: {
      slidesPerView: 1.2,
    },
    540: {
      slidesPerView: 2.5,
    },
    960: {
      slidesPerView: 4,
    },
  },
});

// cardSlide_06
const cardSlide_06 = new Swiper ('.cardSlide_06 .swiperType_card', {
  loop: false,
  slidesPerView: 1.8,
  spaceBetween: 20,
  centeredSlides: false,
  pagination: {
    el: '.cardSlide_06 .swiperType_card .swiper-pagination',
    clickable: true,
  },
  navigation: {
    nextEl: '.cardSlide_06 .swiper-button-next',
    prevEl: '.cardSlide_06 .swiper-button-prev',
  },

  breakpoints: {
    0: {
      slidesPerView: 1.2,
    },
    540: {
      slidesPerView: 2.5,
    },
    960: {
      slidesPerView: 4,
    },
  },
});

// cardSlide_07
const cardSlide_07 = new Swiper ('.cardSlide_07 .swiperType_card', {
  loop: false,
  slidesPerView: 1.8,
  spaceBetween: 20,
  centeredSlides: false,
  pagination: {
    el: '.cardSlide_07 .swiperType_card .swiper-pagination',
    clickable: true,
  },
  navigation: {
    nextEl: '.cardSlide_07 .swiper-button-next',
    prevEl: '.cardSlide_07 .swiper-button-prev',
  },

  breakpoints: {
    0: {
      slidesPerView: 1.2,
    },
    540: {
      slidesPerView: 2.5,
    },
    960: {
      slidesPerView: 4,
    },
  },
});

// thumbNailSlide
const swiper_thumb = new Swiper ('.thumbNailSlide .swiperType_thumb', {
  loop: false,
  spaceBetween: 25,
  centeredSlides: false,
  pagination: {
    el: '.thumbNailSlide .swiperType_thumb .swiper-pagination',
    clickable: true,
  },

  breakpoints: {
    0: {
      slidesPerView: 1.2,
    },
    540: {
      slidesPerView: 3,
    },
  },
});

// Top Slide Menu
const slideTopMenu = new Swiper ('.slideTopMenu', {
  spaceBetween: 0,
  slidesPerView: 2.8,
  watchSlidesProgress: true,
  centeredSlides: false,
});

const subSwiper = new Swiper ('.subSwiper', {
  effect: 'fade',
  fadeEffect: {
    crossFade: true,
  },
  spaceBetween: 10,
  thumbs: {
    swiper: slideTopMenu,
  },
});

// friendSlide
const swiper_friend = new Swiper ('.friendSlide .swiperType_friend', {
  loop: false,
  spaceBetween: 12,
  centeredSlides: false,
  pagination: {
    el: '.friendSlide .swiperType_friend .swiper-pagination',
    clickable: true,
  },

  breakpoints: {
    0: {
      slidesPerView: 3.2,
    },
    540: {
      slidesPerView: 5,
    },
    960: {
      slidesPerView: 5,
    },
  },
});

// myReviewSlide
const myReviewSlide = new Swiper ('.myReviewSlide .swiperType_review', {
  slidesPerView: 1,
  spaceBetween: 20,
  centeredSlides: false,
  pagination: {
    el: '.myReviewSlide .swiperType_review .swiper-pagination',
    clickable: true,
  },
  navigation: {
    nextEl: '.myReviewSlide .swiper-button-next',
    prevEl: '.myReviewSlide .swiper-button-prev',
  },
});

const statusSlide = new Swiper ('.statusSlide .swiper-container', {
  slidesPerView: 1,
  spaceBetween: 5,
  speed: 700,
  loop: false,
  navigation: {
    nextEl: '.statusSlide .swiper-button-next',
    prevEl: '.statusSlide .swiper-button-prev',
  },
});

// UI Common
(() => {
  // Category TabList only DeskTop
  class TabList {
    constructor (opt) {
      this.tab = document.querySelector ('.' + opt.elmName);
      this.tabul = this.tab.firstElementChild;
      this.tabLi = [...this.tabul.children];
      this.target = null;
      this.index = null;
      this.lastChild = null;

      this.active = 'active';
    }
    init () {
      this.tabLi.map (elm => {
        this.target = elm;
        this.mouseEvent ();
      });
    }
    mouseEvent () {
      this.target.addEventListener ('click', e => this.eventHandler (e));
    }
    eventHandler (e) {
      //   e.preventDefault ();
      let type = e.type;

      if (e.target !== e.currentTarget.querySelector ('.subtit')) return;
      this.parent = e.currentTarget.firstElementChild;

      if (!this.parent.classList.contains (this.active)) {
        this.open ();
      } else {
        this.close ();
      }
    }
    open () {
      this.tabLi.map ((elm, idx) => {
        this.elm = elm.firstElementChild;
        this.elm.classList.remove (this.active);
      });
      this.parent.classList.add (this.active);
      this.tab.classList.add (this.active);
    }
    close () {
      this.tabLi.map ((elm, idx) => {
        this.elm = elm.firstElementChild;
        this.elm.classList.remove (this.active);
      });

      this.parent.classList.remove (this.active);
      this.tab.classList.remove (this.active);
    }
  }

  // AddSearch only DeskTop
  // Common Top button
  class AddSearch {
    constructor (opt) {
      this.html = document.querySelector ('html');
      this.body = document.querySelector ('body');
      this.category = document.querySelector ('.pc-category > nav');
      this.addBtn = document.querySelector ('.' + opt.elmName);
      this.addSearch = document.querySelector ('.addSearch');

      this.active = 'active';
    }
    init () {
      this.mouseEvent ();
    }
    mouseEvent () {
      this.category.addEventListener ('click', e => this.eventHandler (e));
      window.addEventListener ('scroll', e => this.scrollEvent (e));
    }
    eventHandler (e) {
      e.preventDefault ();

      this.target = e.target;
      console.log (
        'test',
        !this.target.classList.contains (this.active),
        e.target,
        e.currentTarget
      );
      if (
        !this.target.classList.contains (this.active) &&
        e.target === e.currentTarget.querySelector ('.addSearchBtn')
      ) {
        this.open ();
      } else {
        if (
          e.target === e.currentTarget.querySelector ('.input-search') ||
          e.target === e.currentTarget.querySelector ('.btn-search')
        )
          return;
        this.close ();
      }
    }
    open () {
      this.addBtn.classList.add (this.active);
      this.addSearch.classList.add (this.active);
    }
    close () {
      this.addBtn.classList.remove (this.active);
      this.addSearch.classList.remove (this.active);
    }
    scrollEvent (e) {
      e.preventDefault ();

      this.topBtn = document.querySelector ('.btnTop');
      this.headerH = document.querySelector ('.header').clientHeight;
      this.visualH = document.querySelector ('.visual').clientHeight;

      if (this.html.scrollTop > this.visualH + this.visualH) {
        this.topBtn.classList.add (this.active);
        this.topBtn.addEventListener ('click', e => this.moveTop (e));
      } else {
        this.topBtn.classList.remove (this.active);
      }
    }
    moveTop () {
      window.scrollTo ({top: 0, behavior: 'smooth'});
    }
  }

  // Common ChangeView
  class ChangeView {
    constructor (opt) {
      this.slideName = opt.targetSlideName;
      this.targetBtn = document.querySelector ('.' + opt.elmName);
      this.swiper = document.querySelector ('.' + opt.targetSlideName);
      this.active = 'active';
      this.target = null;
      this.parent = null;
    }
    init () {
      this.mouseEvent ();
    }
    mouseEvent () {
      this.targetBtn.addEventListener ('click', e => this.eventHandler (e));
    }
    eventHandler (e) {
      e.preventDefault ();
      this.target = e.currentTarget.firstElementChild;
      this.parent = e.currentTarget;

      if (!this.parent.classList.contains (this.active)) {
        this.open ();
      } else {
        this.close ();
      }
    }
    open () {
      this.targetBtn.classList.add (this.active);
      this.target.textContent = `전체보기 취소`;
      this.swiper.classList.add (this.active);
      eval (this.slideName).disable ();
    }
    close () {
      this.targetBtn.classList.remove (this.active);
      this.target.textContent = `전체보기`;
      this.swiper.classList.remove (this.active);
      eval (this.slideName).enable ();
    }
  }

  class Vocabulary {
    constructor (opt) {
      this.vocabulary = document.querySelector ('.' + opt.elmName);
      this.vocList = [...document.querySelectorAll ('.vocabulary')];

      this.target = null;
      this.active = 'active';
      this.parent = null;
      this.mother = null;
    }
    init () {
      this.vocList.map (elm => {
        this.target = elm.querySelector ('.addBtn');
        this.mouseEvent ();
      });
    }
    mouseEvent () {
      this.target.addEventListener ('click', e => this.eventHandler (e));
    }
    eventHandler (e) {
      e.preventDefault ();

      this.parent = e.target;
      this.mother = this.parent.closest ('.vocabulary');

      if (!this.parent.classList.contains (this.active)) {
        this.open ();
      } else {
        this.close ();
      }
    }
    open () {
      this.parent.classList.add (this.active);
      this.parent.textContent = `내 단어장에서 삭제하기`;
      this.mother.classList.add (this.active);
    }
    close () {
      this.parent.classList.remove (this.active);
      this.parent.textContent = `내 단어장에 추가하기`;
      this.mother.classList.remove (this.active);
    }
  }

  // Toggle Button
  class Toggle {
    constructor (opt) {
      this.btn = [...document.querySelectorAll ('#' + opt.elmName)];
      this.closeBtn = [...document.querySelectorAll ('.popClose')];
      this.body = document.querySelector ('body');

      this.target = null;
      this.overlay = null;
      this.parent = null;
      this.active = 'active';
      this.hidden = 'hidden';
      this.elmBool = null;
    }
    init () {
      this.btn.forEach (elm => {
        this.target = elm;
        this.mouseEvent ();
      });
      this.closeBtn.forEach (elm => {
        elm.addEventListener ('click', e => this.close ());
      });
    }
    mouseEvent () {
      this.target.addEventListener ('click', e => this.eventHandler (e));
    }
    eventHandler (e) {
      //   e.preventDefault ();

      this.parent = e.currentTarget;
      this.overlay = this.parent.nextElementSibling;
      this.elmBool = this.parent.closest ('.navbar') ? true : false;

      if (!this.parent.classList.contains (this.active)) {
        this.open ();
      } else {
        this.close ();
      }
    }
    open () {
      this.parent.classList.add (this.active);
      this.overlay.classList.add (this.active);
      if (this.elmBool) this.body.classList.add (this.hidden);
    }
    close () {
      this.parent.classList.remove (this.active);
      this.overlay.classList.remove (this.active);
      if (this.elmBool) this.body.classList.remove (this.hidden);
    }
  }

  // Mobile only Nav
  class MoNavi {
    constructor (opt) {
      this.mother = document.querySelector ('.' + opt.elmName);
      this.slideTopMenu = this.mother.querySelector ('.slideTopMenu');
      this.tabSlide = [...this.slideTopMenu.querySelectorAll ('.swiper-slide')];

      this.subSwiper = this.mother.querySelector ('.subSwiper');
      this.subTabLink = [...this.subSwiper.querySelectorAll ('a')];
      this.closeBtn = [...this.subSwiper.querySelectorAll ('.btnClose')];

      this.target = null;
      this.tabLi = null;
      this.subTarget = null;

      this.active = 'active';
      this.menuActive = 'on';
    }
    init () {
      this.tabSlide.map (elm => {
        this.target = elm;
        this.mouseEvent ();
      });
    }
    mouseEvent () {
      this.target.addEventListener ('click', e => this.eventHandler (e));
      this.closeBtn.map (elm => {
        elm.addEventListener ('click', e => this.closeAll ());
      });
    }
    eventHandler (e) {
      e.preventDefault ();
      this.subSwiper.classList.add (this.active);

      // 대메뉴 활성화 클래스 넣기
      if (e.currentTarget.classList.contains ('swiper-slide-thumb-active')) {
        e.currentTarget.classList.add (this.menuActive);
      } else {
        e.currentTarget.classList.remove (this.menuActive);
      }

      this.subTabLink.map (elm => {
        elm.addEventListener ('click', e => this.subTabEventHandler (e));
      });
    }
    subTabEventHandler (e) {
      this.subTarget = e.target;

      if (!e.target.classList.contains (this.active)) {
        this.open ();
      } else {
        this.close ();
      }
    }
    open () {
      this.subTarget.classList.add (this.active);
    }
    close () {
      this.subTarget.classList.remove (this.active);
      // 3 depth check
      if (this.subTarget.nextElementSibling === null) return;
      [...this.subTarget.nextElementSibling.children].map (elm => {
        elm.classList.remove (this.active);
      });
    }
    closeAll () {
      this.subSwiper.classList.remove (this.active);
      this.tabSlide.map (elm => {
        if (elm.classList.contains (this.menuActive)) {
          elm.classList.remove (this.menuActive);
        }
      });
      this.subTabLink.map (elm => {
        if (elm.classList.contains (this.active)) {
          elm.classList.remove (this.active);
        }
      });
    }
  }

  window.addEventListener ('load', () => {
    // PC 버전 : 카테고리
    const isTablist = document.querySelector ('.TabList');
    if (isTablist !== null) {
      const tabList = new TabList ({elmName: 'TabList'});
      tabList.init ();
    }

    // PC 버전 : 검색열기
    const isAddSearch = document.querySelector ('.addSearchBtn');
    if (isAddSearch !== null) {
      const addSearch = new AddSearch ({elmName: 'addSearchBtn'});
      addSearch.init ();
    }

    // 공통 :  전체보기 열기
    const isChangeViewBtn = document.querySelector ('.changeViewBtn');
    if (isChangeViewBtn !== null) {
      const myNoteSlide = new ChangeView ({
        elmName: 'changeViewBtn',
        targetSlideName: 'myNoteSlide',
      });
      myNoteSlide.init ();
    }

    // 공통 :  카드섹션 전체보기 열기
    const isChangeBtn = document.querySelector ('.changeCardBtn');
    if (isChangeBtn !== null) {
      const cardSlide = new ChangeView ({
        elmName: 'changeCardBtn',
        targetSlideName: 'cardSlide',
      });
      cardSlide.init ();
    }

    // 공통 :  단어장 선택
    const vocabulary = new Vocabulary ({elmName: 'vocabulary'});
    vocabulary.init ();

    // 공통 : Toggle
    const toggle = new Toggle ({elmName: 'toggle'});
    toggle.init ();

    // Mobile 버전 : 상단 카테고리
    const isNavi = document.querySelector ('.moNavi');
    if (isNavi !== null) {
      const moNavi = new MoNavi ({elmName: 'moNavi'});
      moNavi.init ();
    }
  });
}) ();

(() => {
  /*============================================================
 * Description : responsive slide
 *============================================================*/
  let ww = $ (window).width ();
  let swiper_report = undefined;
  let chartSldie = undefined;

  function deviceChcek () {
    if (ww < 1400) {
      if (swiper_report == undefined) {
        // reportSlide
        swiper_report = new Swiper ('.reportSlide .swiperType_report', {
          loop: false,
          spaceBetween: 12,
          slidesPerView: 2.2,
          centeredSlides: false,
          pagination: {
            el: '.reportSlide .swiperType_report .swiper-pagination',
            clickable: true,
          },

          breakpoints: {
            0: {
              slidesPerView: 2.2,
            },
            540: {
              slidesPerView: 5,
            },
            960: {
              slidesPerView: 4,
            },
          },
        });
      }
      if (chartSldie == undefined) {
        // chartSldie
        chartSldie = new Swiper ('.chartSldie .swiper-container', {
          speed: 700,
          loop: false,
          navigation: {
            nextEl: '.chartSldie .swiper-button-next',
            prevEl: '.chartSldie .swiper-button-prev',
          },
          pagination: {
            el: '.chartSldie .swiper-pagination',
            clickable: true,
          },
          breakpoints: {
            0: {
              slidesPerView: 1.2,
              spaceBetween: 25,
            },
            540: {
              slidesPerView: 3.2,
              spaceBetween: 20,
            },
            960: {
              slidesPerView: 4,
              spaceBetween: 0,
            },
          },
        });
      }
    } else if (ww > 1400) {
      if (swiper_report !== undefined) {
        swiper_report.destroy ();
        swiper_report = undefined;
      }

      if (chartSldie !== undefined) {
        chartSldie.destroy ();
        chartSldie = undefined;
      }
    }
  }

  /*============================================================
  * Description : Login TAb
  *============================================================*/
  class Tab {
    constructor (opt) {
      this.tab = document.querySelector ('.' + opt.elmName);
      console.log (this.tabUl);
      this.tabUl = this.tab.firstElementChild;
      this.tabLi = [...this.tabUl.children];
      this.parent = null;
      this.target = null;
      this.tabInfo = null;
      this.elm = null;

      this.active = 'active';
      this.addSlide = 'addSlide';
      this.opts = opt.effect;
    }

    init () {
      this.tabLi.map (elm => {
        this.target = elm;
        this.mouseEvent ();

        this.tabUl.firstElementChild.classList.add (this.active);

        if (this.opts === 'slide') {
          this.tabUl.firstElementChild.classList.add (this.addSlide);
        }
      });
    }

    mouseEvent () {
      this.target.addEventListener ('click', e => this.eventHandler (e));
    }
    eventHandler (e) {
      this.parent = e.target.parentElement;
      this.tabInfo = e.target.nextElementSibling;

      if (!this.parent.classList.contains (this.active)) {
        this.tabLi.map (elm => {
          this.elm = elm;
          this.elm.classList.remove (this.active);
          this.parent.classList.add (this.active);

          if (this.opts === 'slide') this.slide ();
        });
      }
    }
    slide () {
      this.elm.classList.remove (this.addSlide);
      this.parent.classList.add (this.addSlide);
    }
  }

  function isTabCheck () {
    const isTab = document.querySelector ('.Tab');
    if (isTab !== null) {
      const tab = new Tab ({
        elmName: 'Tab', // 탭 전체 부모 클래스
        effect: '', // 슬라이드 옵션 활성화 유무 ("sldie" OR " " 로 변경)
      });
      tab.init ();
    }
  }
  window.addEventListener ('load', () => {
    isTabCheck ();

    deviceChcek ();
  });
  window.addEventListener ('resize', () => {
    ww = $ (window).width ();
    isTabCheck ();
    deviceChcek ();
  });
}) ();
